<!-- The resulting page based off the user inputted data for the Production Record -->
<!-- Creates a table for each category of food or drink for the given school day and school -->
<!-- For each table there will be a calculated planned value and then text inputs for all other fields -->
<!-- An API call will send all inputted information to the database upon submission -->
{% extends "layout.html" %}
{% block content %}
<form action = "/insertProduction/" method = "POST">
{% csrf_token %}
   <div class="row">
       <div class="form-group col-xs-4 col-md-4">
          <label for="meal_date" class="control-label">Meal Date</label>
          <input id="meal_date" class="h-50 form-control" placeholder="{{meal_date}}" readonly>
          <input type="hidden" name="date" value="{{meal_date}}">
      </div>
       <div class="form-group col-xs-4 col-md-4">
          <label for="school" class="control-label">Meal Date</label>
          <input id="school" class="h-50 form-control" placeholder="{{school}}" readonly>
          <input type="hidden" name="school" value="{{school}}">
      </div>
       <div class="form-group col-xs-4 col-md-4">
          <label for="submission-date" class="control-label">Meal Date</label>
          <input name="meal" id="submission-date" class="h-50 form-control" placeholder="{{meal}}" readonly>
          <input type="hidden" name="meal" value="{{meal}}">
      </div>
   </div>

   <div class="row">
       <div class="form-group col-xs-4 col-md-4">
          <label for="adult-meals" class="control-label">Adult Meals</label>
          <input type="number" name="adult-meals" id="adult-meals" class="form-control" required>
      </div>
       <div class="form-group col-xs-4 col-md-4">
          <label for="adult-earned-meals" class="control-label">Reimbursable Meal Count</label>
          <input type="number" name="adult-earned-meals" id="adult-earned-meals" class="form-control" required>
      </div>
       <div class="form-group col-xs-4 col-md-4">
          <label for="reimbursable-meals" class="control-label">Meal Date</label>
          <input type="number" name="reimbursable-meals" id="reimbursable-meals" class="form-control" required>
      </div>
   </div>
   <div class="row">
      <div class="form-group col-md-12">
          <label for="daily-notes" class="control-label">Daily Notes</label>
          <textarea id='daily-notes' name="daily-notes" class="form-control">{{daily_notes}}</textarea>
      </div>
   </div>

    <input type = "submit" id="submit_1" value = "Submit" class="btn btn-success btn-lg center-block"
    onclick="return confirm('Are you sure?')">

   <!-- ALL MEALS HAVE A GENERATED DRINKS TABLE -->
   <h2>Drinks</h2>
   <table class="table table-bordered table-striped table-sm">
        <thead>
          <tr>
             <th scope="col"> Component </th>
             <th scope="col"> Planned </th>
             <th scope="col"> Prepared </th>
             <th scope="col"> Served </th>
             <th scope="col"> Leftover </th>
             <th scope="col"> Wasted </th>
             <th scope="col"> Extra Needed </th>
             <th scope="col"> Notes </th>
          </tr>
        </thead>
      {% for key,value in drinks.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>
      {% endfor %}
   </table><br><br>

   

   <!-- ALL MEALS HAVE A GENERATED MAIN MENU TABLE -->
   <h2>Main Menu - {{ menuDay }}</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in components.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}" value="">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>
      {% endfor %}
   </table><br><br>

   <!-- ALL MEALS HAVE A GENERATED FRUIT TABLE -->
   <h2>Fruits</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in fruits.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" 
            onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}" value="">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>
      {% endfor %}
   </table><br><br>

   <!-- GENERATE A SALAD TABLE IF IT IS LUNCH -->
   {% if isLunch %}
   <h2>Salad Bar</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in saladComponents.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" 
            onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}" value="">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>
      {% endfor %}
   </table><br><br>
   {% endif %}

   <!-- GENERATE AN EXPANDED SALAD TABLE IF IT IS AN EXPANDED SCHOOL -->
   {% if isExpanded and isLunch %}
   <h2>Salad Bar Add-On</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in expandedComponents.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" 
            onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}" value="">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>
      {% endfor %}
   </table><br><br>
   {% endif %}

   

   <!-- GENERATE A GRAB AND GO TABLE IF IT IS A GRAB AD GO SCHOOL -->
   {% if isGrab and isLunch%}
   <h2>Grab N Go</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in grabAndGoLunchComponents.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" 
            onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}" value="">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>

      {% endfor %}
   </table><br><br>
   {% endif %}

   {% if isGrab and not isLunch%}
   <h2>Grab N Go</h2>
   <table class="table table-bordered table-striped table-sm">
       <thead>
      <tr>
         <th> Component </th>
         <th> Planned </th>
         <th> Prepared </th>
         <th> Served </th>
         <th> Leftover </th>
         <th> Wasted </th>
         <th> Extra Needed </th>
         <th> Notes </th>
      </tr>
      </thead>
      {% for key,value in grabAndGoBreakComponents.items %}
      <input type="hidden" name="planned-{{ key }}" value="{{ value }}">
      <tr>
         <th scope="row"> {{ key }} </th>
         <td>{{ value }}</td>
         <td><input style="width:75px" type="number" id="prepared-{{ key }}" name="prepared-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="served-{{ key }}" name="served-{{ key }}" 
            onchange="autocalculate('{{ key }}')" required></td>
         <td><input style="width:75px" type="number" id="leftover-{{ key }}" name="leftover-{{ key }}" 
            onchange="autocalculate('{{ key }}')"></td>
         <td id="wastedNum-{{ key }}" ></td>
         <input type="hidden" id="wasted-{{ key }}" name="wasted-{{ key }}">
         <td><input style="width:75px" type="number" id="extra-{{ key }}" name="extra-{{ key }}" required></td>
         <td><input type="text" id="notes-{{ key }}" name="notes-{{ key }}" placeholder="Any notes?"></td>
      </tr>

      {% endfor %}
   </table><br><br>
   
   {% endif %}
   <input type = "submit" id="submit" value = "Submit" class="btn btn-success btn-lg center-block"
          onclick="return confirm('Are you sure?')">
   <br><br><br>
   
<style>

   td {
      padding: 6px;
      text-align: center;
      white-space: nowrap;
   }
</style>
</form>

<script type="text/javascript">
      function autocalculate(comp){
         var prep = document.getElementById("prepared-"+comp).value;
         var served = document.getElementById("served-"+comp).value;
         var leftover = document.getElementById("leftover-"+comp).value;
         document.getElementById("wastedNum-"+comp).innerHTML = prep - served - leftover;
         document.getElementById("wasted-"+comp).value = prep - served - leftover;
      }
   </script>
{% endblock content %}
